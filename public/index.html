<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Cloudflare Zero-Downtime Migration Guide</title>
		<meta name="description" content="Enterprise-grade domain migration checklist for Cloudflare with zero downtime using Partial (CNAME) Setup" />
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			:root {
				--cf-orange: #f48120;
				--cf-orange-hover: #e67419;
				--cf-dark: #0d0d0d;
				--cf-gray: #404040;
				--cf-gray-light: #6b7280;
				--cf-light-gray: #f5f5f5;
				--cf-border: #e0e0e0;
				--cf-border-dark: #d1d5db;
				--success: #059669;
				--success-light: #d1fae5;
				--success-border: #6ee7b7;
				--warning: #d97706;
				--warning-light: #fef3c7;
				--warning-border: #fcd34d;
				--info: #0284c7;
				--info-light: #e0f2fe;
				--info-border: #7dd3fc;
				--danger: #dc2626;
				--danger-light: #fee2e2;
				--shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
				--shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
				--shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
				--shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
				--radius: 8px;
				--radius-lg: 12px;
				--transition: 150ms cubic-bezier(0.4, 0, 0.2, 1);
			}

			html {
				scroll-behavior: smooth;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Helvetica', 'Arial', sans-serif;
				line-height: 1.6;
				color: var(--cf-dark);
				background: var(--cf-light-gray);
				min-height: 100vh;
				display: flex;
				flex-direction: column;
			}

			.container {
				max-width: 1280px;
				margin: 0 auto;
				padding: 0 24px;
				width: 100%;
			}

			/* Header */
			header {
				background: linear-gradient(135deg, var(--cf-dark) 0%, #1a1a2e 100%);
				color: white;
				padding: 32px 0;
				position: relative;
				overflow: hidden;
			}

			header::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
				opacity: 0.5;
			}

			.header-content {
				position: relative;
				display: flex;
				justify-content: space-between;
				align-items: center;
				flex-wrap: wrap;
				gap: 16px;
			}

			.header-text h1 {
				font-size: 1.75rem;
				font-weight: 700;
				margin-bottom: 6px;
				letter-spacing: -0.025em;
			}

			.header-text p {
				font-size: 0.95rem;
				opacity: 0.85;
				font-weight: 400;
			}

			.btn-reset-header {
				display: inline-flex;
				align-items: center;
				gap: 8px;
				padding: 10px 18px;
				background: rgba(255, 255, 255, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				color: white;
				border-radius: var(--radius);
				font-size: 0.875rem;
				font-weight: 500;
				cursor: pointer;
				transition: all var(--transition);
				backdrop-filter: blur(4px);
			}

			.btn-reset-header:hover {
				background: rgba(255, 255, 255, 0.2);
				border-color: rgba(255, 255, 255, 0.3);
				transform: translateY(-1px);
			}

			.btn-reset-header svg {
				width: 16px;
				height: 16px;
			}

			/* Main Content */
			main {
				flex: 1;
				padding: 32px 0;
			}

			/* Progress Bar */
			.progress-bar {
				background: white;
				border-radius: var(--radius-lg);
				padding: 20px 24px;
				margin-bottom: 24px;
				box-shadow: var(--shadow);
				border: 1px solid var(--cf-border);
			}

			.progress-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 12px;
			}

			.progress-info {
				display: flex;
				align-items: center;
				gap: 16px;
			}

			.progress-text {
				font-size: 0.875rem;
				font-weight: 600;
				color: var(--cf-dark);
			}

			.progress-percentage {
				font-size: 0.875rem;
				font-weight: 600;
				color: var(--cf-orange);
				background: rgba(244, 129, 32, 0.1);
				padding: 4px 10px;
				border-radius: 20px;
			}

			.progress-track {
				height: 6px;
				background: var(--cf-border);
				border-radius: 3px;
				overflow: hidden;
			}

			.progress-fill {
				height: 100%;
				background: linear-gradient(90deg, var(--cf-orange), #ff9500);
				border-radius: 3px;
				transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
			}

			/* Steps Layout */
			.steps-container {
				display: grid;
				grid-template-columns: 280px 1fr;
				gap: 24px;
				align-items: start;
			}

			/* Sidebar Navigation */
			.steps-sidebar {
				position: sticky;
				top: 24px;
			}

			.step-nav {
				background: white;
				border-radius: var(--radius-lg);
				padding: 20px;
				box-shadow: var(--shadow);
				border: 1px solid var(--cf-border);
			}

			.step-nav-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 16px;
				padding-bottom: 12px;
				border-bottom: 1px solid var(--cf-border);
			}

			.step-nav h3 {
				font-size: 0.75rem;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				color: var(--cf-gray-light);
				font-weight: 600;
			}

			.step-nav-list {
				display: flex;
				flex-direction: column;
				gap: 4px;
				max-height: calc(100vh - 200px);
				overflow-y: auto;
				scrollbar-width: thin;
				scrollbar-color: var(--cf-border) transparent;
			}

			.step-nav-list::-webkit-scrollbar {
				width: 4px;
			}

			.step-nav-list::-webkit-scrollbar-track {
				background: transparent;
			}

			.step-nav-list::-webkit-scrollbar-thumb {
				background: var(--cf-border);
				border-radius: 2px;
			}

			.step-nav-item {
				padding: 8px 10px;
				border-radius: var(--radius);
				cursor: pointer;
				transition: all var(--transition);
				display: flex;
				align-items: flex-start;
				gap: 8px;
				font-size: 0.8125rem;
				color: var(--cf-gray);
				border: 1px solid transparent;
				line-height: 1.3;
			}

			.step-nav-item:hover {
				background: var(--cf-light-gray);
			}

			.step-nav-item.active {
				background: var(--cf-orange);
				color: white;
				font-weight: 500;
				box-shadow: var(--shadow-sm);
			}

			.step-nav-item.completed:not(.active) {
				color: var(--success);
			}

			.step-number {
				width: 20px;
				height: 20px;
				border-radius: 50%;
				background: var(--cf-border);
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 0.65rem;
				font-weight: 700;
				flex-shrink: 0;
				transition: all var(--transition);
				margin-top: 1px;
			}

			.step-nav-item.active .step-number {
				background: rgba(255, 255, 255, 0.25);
				color: white;
			}

			.step-nav-item.completed:not(.active) .step-number {
				background: var(--success);
				color: white;
			}

			.step-nav-item .step-title {
				flex: 1;
				white-space: normal;
				word-wrap: break-word;
				overflow-wrap: break-word;
			}

			/* Step Content */
			.step-content {
				background: white;
				border-radius: var(--radius-lg);
				padding: 32px;
				box-shadow: var(--shadow);
				border: 1px solid var(--cf-border);
				min-height: 500px;
			}

			.step-header {
				margin-bottom: 28px;
			}

			.step-badge {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				padding: 6px 12px;
				background: linear-gradient(135deg, var(--cf-orange), #ff9500);
				color: white;
				border-radius: 20px;
				font-size: 0.75rem;
				font-weight: 600;
				margin-bottom: 16px;
				text-transform: uppercase;
				letter-spacing: 0.025em;
			}

			.step-title-sidebar {
				font-size: 0.95rem;
				font-weight: 700;
				margin-bottom: 12px;
				color: var(--cf-dark);
				letter-spacing: -0.025em;
				line-height: 1.3;
			}

			.step-title {
				font-size: 1.5rem;
				font-weight: 700;
				margin-bottom: 12px;
				color: var(--cf-dark);
				letter-spacing: -0.025em;
				line-height: 1.3;
			}

			.step-description {
				font-size: 1rem;
				color: var(--cf-gray);
				line-height: 1.7;
			}

			/* Checkpoints */
			.checkpoints {
				margin: 28px 0;
			}

			.checkpoints-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 16px;
			}

			.checkpoints h3 {
				font-size: 0.875rem;
				font-weight: 600;
				color: var(--cf-dark);
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.checkpoints h3::before {
				content: '';
				width: 3px;
				height: 16px;
				background: var(--cf-orange);
				border-radius: 2px;
			}

			.checkpoint {
				padding: 14px 16px;
				background: var(--cf-light-gray);
				border-radius: var(--radius);
				margin-bottom: 8px;
				display: flex;
				align-items: center;
				gap: 14px;
				cursor: pointer;
				transition: all var(--transition);
				border: 1px solid transparent;
				user-select: none;
			}

			.checkpoint:hover {
				background: #eaeaea;
				border-color: var(--cf-border-dark);
			}

			.checkpoint:active {
				transform: scale(0.995);
			}

			.checkpoint.completed {
				background: var(--success-light);
				border-color: var(--success-border);
			}

			.checkpoint.completed:hover {
				background: #c6f6d5;
			}

			.checkbox-wrapper {
				position: relative;
				width: 20px;
				height: 20px;
				flex-shrink: 0;
			}

			.checkbox-wrapper input[type='checkbox'] {
				position: absolute;
				opacity: 0;
				width: 100%;
				height: 100%;
				cursor: pointer;
				z-index: 1;
			}

			.checkbox-custom {
				position: absolute;
				top: 0;
				left: 0;
				width: 20px;
				height: 20px;
				background: white;
				border: 2px solid var(--cf-border-dark);
				border-radius: 4px;
				transition: all var(--transition);
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.checkbox-custom svg {
				width: 12px;
				height: 12px;
				stroke: white;
				stroke-width: 3;
				opacity: 0;
				transform: scale(0.5);
				transition: all var(--transition);
			}

			.checkpoint:hover .checkbox-custom {
				border-color: var(--cf-gray-light);
			}

			.checkpoint.completed .checkbox-custom {
				background: var(--success);
				border-color: var(--success);
			}

			.checkpoint.completed .checkbox-custom svg {
				opacity: 1;
				transform: scale(1);
			}

			.checkpoint-label {
				flex: 1;
				font-size: 0.9375rem;
				color: var(--cf-dark);
				line-height: 1.4;
			}

			.checkpoint.optional .checkpoint-label {
				color: var(--cf-gray);
			}

			.checkpoint-badge {
				font-size: 0.7rem;
				font-weight: 500;
				padding: 3px 8px;
				border-radius: 10px;
				text-transform: uppercase;
				letter-spacing: 0.025em;
			}

			.checkpoint-badge.optional {
				background: var(--cf-border);
				color: var(--cf-gray);
			}

			.checkpoint-badge.required {
				background: rgba(244, 129, 32, 0.1);
				color: var(--cf-orange);
			}

			/* Documentation */
			.documentation {
				margin: 28px 0;
				padding: 20px;
				background: var(--info-light);
				border-left: 3px solid var(--info);
				border-radius: 0 var(--radius) var(--radius) 0;
			}

			.documentation h3 {
				font-size: 0.875rem;
				font-weight: 600;
				margin-bottom: 12px;
				color: var(--info);
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.documentation-links {
				display: flex;
				flex-direction: column;
				gap: 6px;
			}

			.documentation a {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				color: var(--info);
				text-decoration: none;
				padding: 6px 0;
				font-size: 0.875rem;
				transition: all var(--transition);
				word-break: break-all;
			}

			.documentation a:hover {
				color: #0369a1;
				text-decoration: underline;
			}

			.documentation a svg {
				width: 14px;
				height: 14px;
				flex-shrink: 0;
			}

			/* Alerts */
			.alert {
				padding: 16px 20px;
				border-radius: var(--radius);
				margin-bottom: 24px;
				display: flex;
				align-items: flex-start;
				gap: 12px;
				font-size: 0.9375rem;
				line-height: 1.5;
			}

			.alert svg {
				width: 20px;
				height: 20px;
				flex-shrink: 0;
				margin-top: 1px;
			}

			.alert-warning {
				background: var(--warning-light);
				border: 1px solid var(--warning-border);
				color: #92400e;
			}

			.alert-warning svg {
				color: var(--warning);
			}

			.alert-info {
				background: var(--info-light);
				border: 1px solid var(--info-border);
				color: #0c4a6e;
			}

			.alert strong {
				font-weight: 600;
			}

			/* Command Block */
			.command-block {
				background: #1e1e1e;
				color: #d4d4d4;
				padding: 16px 20px;
				border-radius: var(--radius);
				font-family: 'SF Mono', 'Monaco', 'Menlo', 'Consolas', monospace;
				font-size: 0.8125rem;
				margin: 20px 0;
				overflow-x: auto;
				border: 1px solid #333;
			}

			.command-block code {
				display: block;
				white-space: pre;
				line-height: 1.6;
			}

			/* Step Actions */
			.step-actions {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-top: 32px;
				padding-top: 24px;
				border-top: 1px solid var(--cf-border);
				gap: 16px;
			}

			.btn {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				gap: 8px;
				padding: 12px 24px;
				border: none;
				border-radius: var(--radius);
				font-size: 0.9375rem;
				font-weight: 600;
				cursor: pointer;
				transition: all var(--transition);
				text-decoration: none;
			}

			.btn svg {
				width: 18px;
				height: 18px;
			}

			.btn-primary {
				background: var(--cf-orange);
				color: white;
				box-shadow: var(--shadow-sm);
			}

			.btn-primary:hover:not(:disabled) {
				background: var(--cf-orange-hover);
				transform: translateY(-1px);
				box-shadow: var(--shadow-md);
			}

			.btn-secondary {
				background: white;
				color: var(--cf-dark);
				border: 1px solid var(--cf-border-dark);
			}

			.btn-secondary:hover:not(:disabled) {
				background: var(--cf-light-gray);
				border-color: var(--cf-gray-light);
			}

			.btn:disabled {
				opacity: 0.5;
				cursor: not-allowed;
				transform: none !important;
			}

			/* Completion Screen */
			.completion-screen {
				text-align: center;
				padding: 60px 20px;
			}

			.completion-icon {
				width: 80px;
				height: 80px;
				background: var(--success-light);
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				margin: 0 auto 24px;
			}

			.completion-icon svg {
				width: 40px;
				height: 40px;
				color: var(--success);
			}

			.completion-screen h2 {
				font-size: 1.75rem;
				color: var(--cf-dark);
				margin-bottom: 12px;
				font-weight: 700;
			}

			.completion-screen p {
				font-size: 1rem;
				color: var(--cf-gray);
				margin-bottom: 32px;
				max-width: 400px;
				margin-left: auto;
				margin-right: auto;
			}

			/* Footer */
			footer {
				background: white;
				border-top: 1px solid var(--cf-border);
				padding: 24px 0;
				margin-top: auto;
			}

			.footer-content {
				text-align: center;
			}

			.footer-disclaimer {
				font-size: 0.8125rem;
				color: var(--cf-gray-light);
				line-height: 1.6;
				max-width: 700px;
				margin: 0 auto;
			}

			.footer-disclaimer strong {
				color: var(--cf-gray);
				font-weight: 600;
			}

			/* Responsive */
			@media (max-width: 1024px) {
				.steps-container {
					grid-template-columns: 240px 1fr;
					gap: 20px;
				}
			}

			@media (max-width: 768px) {
				.container {
					padding: 0 16px;
				}

				header {
					padding: 24px 0;
				}

				.header-content {
					flex-direction: column;
					align-items: flex-start;
				}

				.header-text h1 {
					font-size: 1.5rem;
				}

				.btn-reset-header {
					width: 100%;
					justify-content: center;
				}

				main {
					padding: 20px 0;
				}

				.steps-container {
					grid-template-columns: 1fr;
				}

				.steps-sidebar {
					position: static;
				}

				.step-nav-list {
					max-height: none;
					flex-direction: row;
					flex-wrap: wrap;
					gap: 8px;
				}

				.step-nav-item {
					flex: 0 0 auto;
					padding: 8px 12px;
				}

				.step-nav-item .step-title {
					display: none;
				}

				.step-content {
					padding: 24px 20px;
					min-height: auto;
				}

				.step-title {
					font-size: 1.25rem;
				}

				.step-actions {
					flex-direction: column;
				}

				.step-actions .btn {
					width: 100%;
				}
			}

			/* Animations */
			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(8px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.step-content > * {
				animation: fadeIn 0.3s ease-out;
			}
		</style>
	</head>
	<body>
		<header>
			<div class="container">
				<div class="header-content">
					<div class="header-text">
						<h1>Cloudflare Zero-Downtime Migration</h1>
						<p>Enterprise domain migration checklist with Partial (CNAME) Setup</p>
					</div>
					<button class="btn-reset-header" onclick="guide.resetMigration()" title="Reset all progress">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
							<path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
						</svg>
						Reset All
					</button>
				</div>
			</div>
		</header>

		<main>
			<div class="container">
				<div class="progress-bar">
					<div class="progress-header">
						<div class="progress-info">
							<span class="progress-text" id="progress-text">Step 1 of 13</span>
						</div>
						<span class="progress-percentage" id="progress-percentage">0%</span>
					</div>
					<div class="progress-track">
						<div class="progress-fill" id="progress-fill"></div>
					</div>
				</div>

				<div class="steps-container">
					<aside class="steps-sidebar">
						<nav class="step-nav">
							<div class="step-nav-header">
								<h3>Migration Steps</h3>
							</div>
							<div class="step-nav-list" id="step-nav-list"></div>
						</nav>
					</aside>

					<section class="step-content">
						<div id="step-container"></div>
					</section>
				</div>
			</div>
		</main>

		<footer>
			<div class="container">
				<div class="footer-content">
					<p class="footer-disclaimer">
						<strong>Disclaimer:</strong> This tool is provided for educational and informational purposes only. 
						It is the user's responsibility to thoroughly review all configurations, verify DNS records, and validate 
						SSL/TLS certificates before and after migration. Always test in a non-production environment first. 
						The authors assume no liability for any issues arising from the use of this guide.
					</p>
				</div>
			</div>
		</footer>

		<script>
			class MigrationGuide {
				constructor() {
					this.steps = [];
					this.currentStepIndex = 0;
					this.state = this.loadState();
					this.init();
				}

				async init() {
					await this.loadSteps();
					this.renderStepNav();
					this.renderCurrentStep();
					this.updateProgress();
				}

				async loadSteps() {
					try {
						const response = await fetch('/api/steps');
						const data = await response.json();
						this.steps = data.steps;

						// Restore checkpoint state and current step
						if (this.state.currentStep !== undefined) {
							this.currentStepIndex = Math.min(this.state.currentStep, this.steps.length - 1);
						}
						if (this.state.checkpoints) {
							this.steps.forEach((step, stepIndex) => {
								step.checkpoints.forEach((checkpoint, checkIndex) => {
									const stateKey = `${stepIndex}-${checkIndex}`;
									if (this.state.checkpoints[stateKey]) {
										checkpoint.completed = true;
									}
								});
							});
						}
					} catch (error) {
						console.error('Failed to load steps:', error);
					}
				}

				loadState() {
					const saved = localStorage.getItem('cf-migration-state');
					return saved ? JSON.parse(saved) : { currentStep: 0, checkpoints: {} };
				}

				saveState() {
					const checkpoints = {};
					this.steps.forEach((step, stepIndex) => {
						step.checkpoints.forEach((checkpoint, checkIndex) => {
							if (checkpoint.completed) {
								checkpoints[`${stepIndex}-${checkIndex}`] = true;
							}
						});
					});

					this.state = {
						currentStep: this.currentStepIndex,
						checkpoints,
					};

					localStorage.setItem('cf-migration-state', JSON.stringify(this.state));
				}

				renderStepNav() {
					const navList = document.getElementById('step-nav-list');
					navList.innerHTML = '';

					this.steps.forEach((step, index) => {
						const item = document.createElement('div');
						item.className = 'step-nav-item';
						if (index === this.currentStepIndex) item.classList.add('active');
						if (this.isStepCompleted(index)) item.classList.add('completed');

						item.innerHTML = `
							<div class="step-number">${index + 1}</div>
							<div class="step-title-sidebar">${step.title}</div>
						`;

						item.addEventListener('click', () => {
							this.currentStepIndex = index;
							this.renderStepNav();
							this.renderCurrentStep();
							this.updateProgress();
							this.saveState();
						});

						navList.appendChild(item);
					});
				}

				renderCurrentStep() {
					const container = document.getElementById('step-container');
					const step = this.steps[this.currentStepIndex];

					if (this.currentStepIndex === this.steps.length) {
						container.innerHTML = `
							<div class="completion-screen">
								<div class="completion-icon">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
										<path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
									</svg>
								</div>
								<h2>Migration Complete</h2>
								<p>Your domain has been successfully migrated to Cloudflare with zero downtime.</p>
								<button class="btn btn-primary" onclick="guide.resetMigration()">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
										<path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
									</svg>
									Start New Migration
								</button>
							</div>
						`;
						return;
					}

					let warningHtml = '';
					if (this.currentStepIndex === 8) {
						warningHtml = `
							<div class="alert alert-warning">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
								</svg>
								<div><strong>DNSSEC Warning:</strong> If DNSSEC is currently enabled at your authoritative DNS provider, you must either disable it 24 hours before continuing, or set up multi-signer DNSSEC following the advanced guide.</div>
							</div>
						`;
					} else if (this.currentStepIndex === 11) {
						warningHtml = `
							<div class="alert alert-warning">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
								</svg>
								<div><strong>Important:</strong> Ensure all DNS records are in place before changing nameservers. While records remain DNS-only (gray cloud), Cloudflare TLS certificates will not apply to trafficâ€”your origin must handle TLS directly.</div>
							</div>
						`;
					}

					let commandExample = '';
					if (this.currentStepIndex === 6) {
						commandExample = `
							<div class="command-block">
								<code># Retrieve Cloudflare Anycast IPs for your domain
dig +short yourdomain.com.cdn.cloudflare.net

# Example: Add to /etc/hosts (macOS/Linux)
104.21.XX.XXX yourdomain.com
104.21.XX.XXX www.yourdomain.com

# Windows: C:\\Windows\\System32\\drivers\\etc\\hosts</code>
							</div>
						`;
					}

					const checkpointsHtml = step.checkpoints
						.map(
							(checkpoint, index) => `
							<div class="checkpoint ${checkpoint.completed ? 'completed' : ''} ${checkpoint.optional ? 'optional' : ''}"
								 data-step-index="${this.currentStepIndex}"
								 data-checkpoint-index="${index}"
								 onclick="guide.handleCheckpointClick(event, ${this.currentStepIndex}, ${index})">
								<div class="checkbox-wrapper">
									<input type="checkbox" ${checkpoint.completed ? 'checked' : ''} tabindex="-1">
									<div class="checkbox-custom">
										<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
											<path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
										</svg>
									</div>
								</div>
								<div class="checkpoint-label">${checkpoint.label}</div>
								<span class="checkpoint-badge ${checkpoint.optional ? 'optional' : 'required'}">${checkpoint.optional ? 'Optional' : 'Required'}</span>
							</div>
						`
						)
						.join('');

					const docsHtml = step.documentation
						.map(
							(url) => `
							<a href="${url}" target="_blank" rel="noopener">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
								</svg>
								${this.formatDocUrl(url)}
							</a>
						`
						)
						.join('');

					const requiredCount = step.checkpoints.filter((cp) => !cp.optional).length;
					const completedRequired = step.checkpoints.filter((cp) => !cp.optional && cp.completed).length;

					container.innerHTML = `
						<div class="step-header">
							<div class="step-badge">Step ${this.currentStepIndex + 1} of ${this.steps.length}</div>
							<h2 class="step-title">${step.title}</h2>
							<p class="step-description">${step.description}</p>
						</div>

						${warningHtml}
						${commandExample}

						<div class="checkpoints">
							<div class="checkpoints-header">
								<h3>Checkpoints</h3>
							</div>
							${checkpointsHtml}
						</div>

						<div class="documentation">
							<h3>
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="18" height="18">
									<path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
								</svg>
								Official Documentation
							</h3>
							<div class="documentation-links">
								${docsHtml}
							</div>
						</div>

						<div class="step-actions">
							<button class="btn btn-secondary" onclick="guide.previousStep()" ${this.currentStepIndex === 0 ? 'disabled' : ''}>
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
								</svg>
								Previous
							</button>
							<button class="btn btn-primary" onclick="guide.nextStep()" ${!this.canProceed() ? 'disabled' : ''}>
								${this.currentStepIndex === this.steps.length - 1 ? 'Complete Migration' : 'Next Step'}
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
									<path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
								</svg>
							</button>
						</div>
					`;
				}

				formatDocUrl(url) {
					try {
						const urlObj = new URL(url);
						const path = urlObj.pathname;
						// Extract meaningful part of the path
						const parts = path.split('/').filter(Boolean);
						if (parts.length > 2) {
							return parts.slice(-2).join('/') + '/';
						}
						return path;
					} catch {
						return url;
					}
				}

				handleCheckpointClick(event, stepIndex, checkpointIndex) {
					// Prevent double-triggering from checkbox click
					if (event.target.type === 'checkbox') {
						event.preventDefault();
					}
					this.toggleCheckpoint(stepIndex, checkpointIndex);
				}

				toggleCheckpoint(stepIndex, checkpointIndex) {
					const checkpoint = this.steps[stepIndex].checkpoints[checkpointIndex];
					checkpoint.completed = !checkpoint.completed;
					this.renderStepNav();
					this.renderCurrentStep();
					this.updateProgress();
					this.saveState();
				}

				canProceed() {
					const step = this.steps[this.currentStepIndex];
					return step.checkpoints.filter((cp) => !cp.optional).every((cp) => cp.completed);
				}

				isStepCompleted(stepIndex) {
					const step = this.steps[stepIndex];
					return step.checkpoints.filter((cp) => !cp.optional).every((cp) => cp.completed);
				}

				nextStep() {
					if (this.canProceed()) {
						this.currentStepIndex++;
						this.renderStepNav();
						this.renderCurrentStep();
						this.updateProgress();
						this.saveState();
						window.scrollTo({ top: 0, behavior: 'smooth' });
					}
				}

				previousStep() {
					if (this.currentStepIndex > 0) {
						this.currentStepIndex--;
						this.renderStepNav();
						this.renderCurrentStep();
						this.updateProgress();
						this.saveState();
						window.scrollTo({ top: 0, behavior: 'smooth' });
					}
				}

				resetMigration() {
					if (this.steps.some((step) => step.checkpoints.some((cp) => cp.completed))) {
						if (!confirm('Are you sure you want to reset all progress? This action cannot be undone.')) {
							return;
						}
					}

					// Clear all checkpoints
					this.steps.forEach((step) => {
						step.checkpoints.forEach((checkpoint) => {
							checkpoint.completed = false;
						});
					});

					// Reset to first step
					this.currentStepIndex = 0;

					// Clear localStorage
					localStorage.removeItem('cf-migration-state');
					this.state = { currentStep: 0, checkpoints: {} };

					// Re-render everything
					this.renderStepNav();
					this.renderCurrentStep();
					this.updateProgress();
					window.scrollTo({ top: 0, behavior: 'smooth' });
				}

				updateProgress() {
					const totalSteps = this.steps.length;
					const completedSteps = this.steps.filter((_, index) => this.isStepCompleted(index)).length;
					const percentage = Math.round((completedSteps / totalSteps) * 100);

					document.getElementById('progress-text').textContent = `Step ${this.currentStepIndex + 1} of ${totalSteps}`;
					document.getElementById('progress-percentage').textContent = `${percentage}%`;
					document.getElementById('progress-fill').style.width = `${percentage}%`;
				}
			}

			const guide = new MigrationGuide();
		</script>
	</body>
</html>

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Cloudflare Zero-Downtime Migration Guide</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			:root {
				--cf-orange: #f48120;
				--cf-dark: #0d0d0d;
				--cf-gray: #404040;
				--cf-light-gray: #f5f5f5;
				--cf-border: #e0e0e0;
				--success: #2ea44f;
				--warning: #fb8500;
				--info: #0969da;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
				line-height: 1.6;
				color: var(--cf-dark);
				background: var(--cf-light-gray);
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
			}

			header {
				background: var(--cf-dark);
				color: white;
				padding: 30px 0;
				margin-bottom: 40px;
			}

			header h1 {
				font-size: 2rem;
				font-weight: 700;
				margin-bottom: 10px;
			}

			header p {
				font-size: 1.1rem;
				opacity: 0.9;
			}

			.progress-bar {
				background: white;
				border-radius: 8px;
				padding: 20px;
				margin-bottom: 30px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			}

			.progress-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 15px;
			}

			.progress-track {
				height: 8px;
				background: var(--cf-border);
				border-radius: 4px;
				overflow: hidden;
			}

			.progress-fill {
				height: 100%;
				background: linear-gradient(90deg, var(--cf-orange), #ff9500);
				transition: width 0.3s ease;
			}

			.steps-container {
				display: flex;
				gap: 30px;
			}

			.steps-sidebar {
				width: 300px;
				flex-shrink: 0;
			}

			.step-nav {
				background: white;
				border-radius: 8px;
				padding: 15px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
				position: sticky;
				top: 20px;
			}

			.step-nav h3 {
				font-size: 0.9rem;
				text-transform: uppercase;
				letter-spacing: 0.5px;
				color: var(--cf-gray);
				margin-bottom: 15px;
			}

			.step-nav-item {
				padding: 10px;
				margin-bottom: 5px;
				border-radius: 6px;
				cursor: pointer;
				transition: background 0.2s;
				display: flex;
				align-items: center;
				gap: 10px;
			}

			.step-nav-item:hover {
				background: var(--cf-light-gray);
			}

			.step-nav-item.active {
				background: var(--cf-orange);
				color: white;
			}

			.step-nav-item.completed {
				color: var(--success);
			}

			.step-nav-item .step-number {
				width: 24px;
				height: 24px;
				border-radius: 50%;
				background: var(--cf-border);
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 0.8rem;
				font-weight: 700;
			}

			.step-nav-item.active .step-number {
				background: rgba(255, 255, 255, 0.3);
			}

			.step-nav-item.completed .step-number {
				background: var(--success);
				color: white;
			}

			.step-content {
				flex: 1;
				background: white;
				border-radius: 8px;
				padding: 40px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			}

			.step-header {
				margin-bottom: 30px;
			}

			.step-badge {
				display: inline-block;
				padding: 6px 12px;
				background: var(--cf-orange);
				color: white;
				border-radius: 20px;
				font-size: 0.85rem;
				font-weight: 600;
				margin-bottom: 15px;
			}

			.step-title {
				font-size: 1.8rem;
				font-weight: 700;
				margin-bottom: 15px;
			}

			.step-description {
				font-size: 1.1rem;
				color: var(--cf-gray);
				line-height: 1.7;
			}

			.checkpoints {
				margin: 30px 0;
			}

			.checkpoints h3 {
				font-size: 1.2rem;
				margin-bottom: 15px;
			}

			.checkpoint {
				padding: 15px;
				background: var(--cf-light-gray);
				border-radius: 6px;
				margin-bottom: 10px;
				display: flex;
				align-items: center;
				gap: 12px;
				cursor: pointer;
				transition: all 0.2s;
			}

			.checkpoint:hover {
				background: #e8e8e8;
			}

			.checkpoint input[type='checkbox'] {
				width: 20px;
				height: 20px;
				cursor: pointer;
			}

			.checkpoint.completed {
				background: #e6f7ed;
				border: 1px solid var(--success);
			}

			.checkpoint-label {
				flex: 1;
				font-size: 1rem;
			}

			.checkpoint.optional .checkpoint-label::after {
				content: ' (optional)';
				color: var(--cf-gray);
				font-size: 0.9rem;
				font-style: italic;
			}

			.documentation {
				margin: 30px 0;
				padding: 20px;
				background: #f0f8ff;
				border-left: 4px solid var(--info);
				border-radius: 6px;
			}

			.documentation h3 {
				font-size: 1.1rem;
				margin-bottom: 12px;
				color: var(--info);
			}

			.documentation a {
				display: block;
				color: var(--info);
				text-decoration: none;
				padding: 8px 0;
				font-size: 0.95rem;
			}

			.documentation a:hover {
				text-decoration: underline;
			}

			.step-actions {
				display: flex;
				justify-content: space-between;
				margin-top: 40px;
				padding-top: 30px;
				border-top: 1px solid var(--cf-border);
			}

			.btn {
				padding: 12px 24px;
				border: none;
				border-radius: 6px;
				font-size: 1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.2s;
			}

			.btn-primary {
				background: var(--cf-orange);
				color: white;
			}

			.btn-primary:hover:not(:disabled) {
				background: #e67419;
				transform: translateY(-1px);
				box-shadow: 0 4px 12px rgba(244, 129, 32, 0.3);
			}

			.btn-secondary {
				background: white;
				color: var(--cf-dark);
				border: 2px solid var(--cf-border);
			}

			.btn-secondary:hover:not(:disabled) {
				border-color: var(--cf-gray);
			}

			.btn:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			.alert {
				padding: 15px 20px;
				border-radius: 6px;
				margin-bottom: 20px;
				display: flex;
				align-items: flex-start;
				gap: 12px;
			}

			.alert-warning {
				background: #fff3cd;
				border: 1px solid var(--warning);
				color: #856404;
			}

			.alert-info {
				background: #d1ecf1;
				border: 1px solid var(--info);
				color: #0c5460;
			}

			.command-block {
				background: #1e1e1e;
				color: #d4d4d4;
				padding: 15px;
				border-radius: 6px;
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 0.9rem;
				margin: 15px 0;
				overflow-x: auto;
			}

			.command-block code {
				display: block;
				white-space: pre;
			}

			.completion-screen {
				text-align: center;
				padding: 60px 20px;
			}

			.completion-screen h2 {
				font-size: 2.5rem;
				color: var(--success);
				margin-bottom: 20px;
			}

			.completion-screen p {
				font-size: 1.2rem;
				color: var(--cf-gray);
				margin-bottom: 30px;
			}

			@media (max-width: 768px) {
				.steps-container {
					flex-direction: column;
				}

				.steps-sidebar {
					width: 100%;
				}

				.step-nav {
					position: static;
				}

				.step-content {
					padding: 20px;
				}
			}
		</style>
	</head>
	<body>
		<header>
			<div class="container">
				<h1>üöÄ Cloudflare Zero-Downtime Migration</h1>
				<p>Complete domain migration guide with Partial (CNAME) Setup testing phase</p>
			</div>
		</header>

		<div class="container">
			<div class="progress-bar">
				<div class="progress-header">
					<span id="progress-text">Step 1 of 12</span>
					<span id="progress-percentage">0%</span>
				</div>
				<div class="progress-track">
					<div class="progress-fill" id="progress-fill"></div>
				</div>
			</div>

			<div class="steps-container">
				<aside class="steps-sidebar">
					<nav class="step-nav">
						<h3>Migration Steps</h3>
						<div id="step-nav-list"></div>
					</nav>
				</aside>

				<main class="step-content">
					<div id="step-container"></div>
				</main>
			</div>
		</div>

		<script>
			class MigrationGuide {
				constructor() {
					this.steps = [];
					this.currentStepIndex = 0;
					this.state = this.loadState();
					this.init();
				}

				async init() {
					await this.loadSteps();
					this.renderStepNav();
					this.renderCurrentStep();
					this.updateProgress();
				}

				async loadSteps() {
					try {
						const response = await fetch('/api/steps');
						const data = await response.json();
						this.steps = data.steps;

						// Restore checkpoint state
						if (this.state.checkpoints) {
							this.steps.forEach((step, stepIndex) => {
								step.checkpoints.forEach((checkpoint, checkIndex) => {
									const stateKey = `${stepIndex}-${checkIndex}`;
									if (this.state.checkpoints[stateKey]) {
										checkpoint.completed = true;
									}
								});
							});
						}
					} catch (error) {
						console.error('Failed to load steps:', error);
					}
				}

				loadState() {
					const saved = localStorage.getItem('cf-migration-state');
					return saved ? JSON.parse(saved) : { currentStep: 0, checkpoints: {} };
				}

				saveState() {
					const checkpoints = {};
					this.steps.forEach((step, stepIndex) => {
						step.checkpoints.forEach((checkpoint, checkIndex) => {
							if (checkpoint.completed) {
								checkpoints[`${stepIndex}-${checkIndex}`] = true;
							}
						});
					});

					this.state = {
						currentStep: this.currentStepIndex,
						checkpoints,
					};

					localStorage.setItem('cf-migration-state', JSON.stringify(this.state));
				}

				renderStepNav() {
					const navList = document.getElementById('step-nav-list');
					navList.innerHTML = '';

					this.steps.forEach((step, index) => {
						const item = document.createElement('div');
						item.className = 'step-nav-item';
						if (index === this.currentStepIndex) item.classList.add('active');
						if (this.isStepCompleted(index)) item.classList.add('completed');

						item.innerHTML = `
                        <div class="step-number">${index + 1}</div>
                        <div>${step.title}</div>
                    `;

						item.addEventListener('click', () => {
							this.currentStepIndex = index;
							this.renderStepNav();
							this.renderCurrentStep();
							this.updateProgress();
							this.saveState();
						});

						navList.appendChild(item);
					});
				}

				renderCurrentStep() {
					const container = document.getElementById('step-container');
					const step = this.steps[this.currentStepIndex];

					if (this.currentStepIndex === this.steps.length) {
						container.innerHTML = `
                        <div class="completion-screen">
                            <h2>‚úÖ Migration Complete!</h2>
                            <p>Your domain has been successfully migrated to Cloudflare with zero downtime.</p>
                            <button class="btn btn-primary" onclick="location.reload()">Start New Migration</button>
                        </div>
                    `;
						return;
					}

					let warningHtml = '';
					if (this.currentStepIndex === 7) {
						warningHtml = `
                        <div class="alert alert-warning">
                            <strong>‚ö†Ô∏è DNSSEC Warning:</strong> If DNSSEC is currently enabled at your authoritative DNS provider, you must either disable it 24 hours before continuing, or set up multi-signer DNSSEC following the advanced guide.
                        </div>
                    `;
					} else if (this.currentStepIndex === 10) {
						warningHtml = `
                        <div class="alert alert-warning">
                            <strong>‚ö†Ô∏è Critical Step:</strong> Ensure your SSL/TLS certificate is Active before changing nameservers to prevent SSL errors.
                        </div>
                    `;
					}

					let commandExample = '';
					if (this.currentStepIndex === 5) {
						commandExample = `
                        <div class="command-block">
                            <code># Retrieve Cloudflare Anycast IPs for your domain
dig +short yourdomain.com.cdn.cloudflare.net

# Example: Add to /etc/hosts (macOS/Linux)
104.21.XX.XXX yourdomain.com
104.21.XX.XXX www.yourdomain.com

# Windows: C:\\Windows\\System32\\drivers\\etc\\hosts</code>
                        </div>
                    `;
					}

					const checkpointsHtml = step.checkpoints
						.map(
							(checkpoint, index) => `
                    <div class="checkpoint ${checkpoint.completed ? 'completed' : ''} ${checkpoint.optional ? 'optional' : ''}"
                         data-checkpoint-index="${index}">
                        <input type="checkbox" 
                               ${checkpoint.completed ? 'checked' : ''}
                               onchange="guide.toggleCheckpoint(${this.currentStepIndex}, ${index})">
                        <div class="checkpoint-label">${checkpoint.label}</div>
                    </div>
                `
						)
						.join('');

					const docsHtml = step.documentation.map((url) => `<a href="${url}" target="_blank" rel="noopener">${url}</a>`).join('');

					container.innerHTML = `
                    <div class="step-header">
                        <div class="step-badge">Step ${this.currentStepIndex + 1} of ${this.steps.length}</div>
                        <h2 class="step-title">${step.title}</h2>
                        <p class="step-description">${step.description}</p>
                    </div>

                    ${warningHtml}
                    ${commandExample}

                    <div class="checkpoints">
                        <h3>Checkpoints</h3>
                        ${checkpointsHtml}
                    </div>

                    <div class="documentation">
                        <h3>üìö Official Documentation</h3>
                        ${docsHtml}
                    </div>

                    <div class="step-actions">
                        <button class="btn btn-secondary" 
                                onclick="guide.previousStep()"
                                ${this.currentStepIndex === 0 ? 'disabled' : ''}>
                            ‚Üê Previous
                        </button>
                        <button class="btn btn-primary" 
                                onclick="guide.nextStep()"
                                ${!this.canProceed() ? 'disabled' : ''}>
                            ${this.currentStepIndex === this.steps.length - 1 ? 'Complete Migration' : 'Next Step ‚Üí'}
                        </button>
                    </div>
                `;
				}

				toggleCheckpoint(stepIndex, checkpointIndex) {
					const checkpoint = this.steps[stepIndex].checkpoints[checkpointIndex];
					checkpoint.completed = !checkpoint.completed;
					this.renderStepNav();
					this.renderCurrentStep();
					this.updateProgress();
					this.saveState();
				}

				canProceed() {
					const step = this.steps[this.currentStepIndex];
					return step.checkpoints.filter((cp) => !cp.optional).every((cp) => cp.completed);
				}

				isStepCompleted(stepIndex) {
					const step = this.steps[stepIndex];
					return step.checkpoints.filter((cp) => !cp.optional).every((cp) => cp.completed);
				}

				nextStep() {
					if (this.canProceed()) {
						this.currentStepIndex++;
						this.renderStepNav();
						this.renderCurrentStep();
						this.updateProgress();
						this.saveState();
						window.scrollTo({ top: 0, behavior: 'smooth' });
					}
				}

				previousStep() {
					if (this.currentStepIndex > 0) {
						this.currentStepIndex--;
						this.renderStepNav();
						this.renderCurrentStep();
						this.updateProgress();
						this.saveState();
						window.scrollTo({ top: 0, behavior: 'smooth' });
					}
				}

				updateProgress() {
					const totalSteps = this.steps.length;
					const completedSteps = this.steps.filter((_, index) => this.isStepCompleted(index)).length;
					const percentage = Math.round((completedSteps / totalSteps) * 100);

					document.getElementById('progress-text').textContent = `Step ${this.currentStepIndex + 1} of ${totalSteps}`;
					document.getElementById('progress-percentage').textContent = `${percentage}% Complete`;
					document.getElementById('progress-fill').style.width = `${percentage}%`;
				}
			}

			const guide = new MigrationGuide();
		</script>
	</body>
</html>
